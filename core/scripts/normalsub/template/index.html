<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ username }} - Подписка</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
    <div class="background-animation"></div>

    <div id="loading-indicator" class="loading-indicator" aria-hidden="true">
        <div class="spinner" role="status" aria-label="Загрузка"></div>
    </div>

    <div class="container">
        <header class="header">
            <h1 class="header-title"><strong>Ваша подписка</strong></h1>
            <button id="dark-mode-toggle" class="theme-toggle" aria-label="Переключить тему">
                <i id="theme-icon" class="fas fa-sun" aria-hidden="true"></i>
            </button>
        </header>

        <main>
            <!-- Инфо -->
            <section class="info-grid">
                <div class="card info-card">
                    <div class="card-icon"><i class="fas fa-user"></i></div>
                    <div>
                        <div class="card-title">Ваш ID</div>
                        <div class="card-value">{{ username }}</div>
                    </div>
                </div>

                <div class="card info-card">
                    <div class="card-icon"><i class="fas fa-chart-line"></i></div>
                    <div data-tooltip="{{ usage_raw }}">
                        <div class="card-title">Использовано</div>
                        <div class="card-value">{{ usage }}</div>
                    </div>
                </div>

                <div class="card info-card">
                    <div class="card-icon"><i class="fas fa-calendar-check"></i></div>
                    <div>
                        <div class="card-title">Истекает</div>
                        <div class="card-value">{{ expiration_date }}</div>
                    </div>
                </div>
            </section>

            <!-- Приложения -->
            <section class="card app-import-section {% if blocked %}blocked{% endif %}">
                <div class="card-header">
                    <i class="fas fa-link"></i>
                    <h2>Подключение приложений</h2>
                </div>

                <div class="card-body">
                    {% if blocked %}
                        <div class="blocked-message">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Аккаунт приостановлен</h3>
                            <p>Подписка сейчас недоступна.</p>
                        </div>
                    {% else %}

                    <div class="app-tabs">
                        <div class="app-tabs-nav" role="tablist">
                            <button class="app-tab-btn active" data-target="#tab-general">Общее</button>
                            <button class="app-tab-btn" data-target="#tab-singbox">Sing-Box</button>
                            <button class="app-tab-btn" data-target="#tab-hiddify">Hiddify</button>
                            <button class="app-tab-btn" data-target="#tab-streisand">Streisand</button>
                            <button class="app-tab-btn" data-target="#tab-nekobox">NekoBox</button>
                        </div>

                        <div class="app-tabs-content">
                            <!-- Общее -->
                            <div class="app-tab-pane active" id="tab-general">
                                {% if sublink_qrcode %}
                                    <img src="{{ sublink_qrcode }}" class="qrcode" alt="QR подписки">
                                {% else %}
                                    <div class="qr-placeholder">
                                        <i class="fas fa-qrcode"></i>
                                        <div>
                                            <div class="qr-placeholder-title">QR недоступен</div>
                                            <div class="qr-placeholder-text">Скопируйте ссылку ниже</div>
                                        </div>
                                    </div>
                                {% endif %}

                                <div class="btn-row">
                                    <button class="btn btn-secondary" data-copy-text="{{ sub_link }}">
                                        <i class="fas fa-copy"></i> Копировать ссылку
                                    </button>
                                </div>
                            </div>

                            <!-- Sing-Box -->
                            <div class="app-tab-pane" id="tab-singbox">
                                {% if singbox_qrcode %}
                                    <img src="{{ singbox_qrcode }}" class="qrcode">
                                {% else %}
                                    <div class="qr-placeholder"><i class="fas fa-qrcode"></i> QR недоступен</div>
                                {% endif %}
                                <a class="btn btn-secondary" href="sing-box://import-remote-profile?url={{ sub_link }}">
                                    Добавить в Sing-Box
                                </a>
                            </div>

                            <!-- Hiddify -->
                            <div class="app-tab-pane" id="tab-hiddify">
                                {% if hiddify_qrcode %}
                                    <img src="{{ hiddify_qrcode }}" class="qrcode">
                                {% else %}
                                    <div class="qr-placeholder"><i class="fas fa-qrcode"></i> QR недоступен</div>
                                {% endif %}
                                <a class="btn btn-secondary" href="hiddify://import/{{ sub_link }}">
                                    Добавить в Hiddify
                                </a>
                            </div>

                            <!-- Streisand -->
                            <div class="app-tab-pane" id="tab-streisand">
                                {% if streisand_qrcode %}
                                    <img src="{{ streisand_qrcode }}" class="qrcode">
                                {% else %}
                                    <div class="qr-placeholder"><i class="fas fa-qrcode"></i> QR недоступен</div>
                                {% endif %}
                                <a class="btn btn-secondary" href="streisand://import/sub?url={{ sub_link }}">
                                    Добавить в Streisand
                                </a>
                            </div>

                            <!-- NekoBox -->
                            <div class="app-tab-pane" id="tab-nekobox">
                                {% if nekobox_qrcode %}
                                    <img src="{{ nekobox_qrcode }}" class="qrcode">
                                {% else %}
                                    <div class="qr-placeholder"><i class="fas fa-qrcode"></i> QR недоступен</div>
                                {% endif %}
                                <a class="btn btn-secondary" href="nekobox://import?url={{ sub_link }}">
                                    Добавить в NekoBox
                                </a>
                            </div>
                        </div>
                    </div>

                    {% endif %}
                </div>
            </section>

            {% if local_uris and not blocked %}
            <section class="card uri-section">
                <div class="card-header">
                    <i class="fas fa-server"></i>
                    <h2>Подключение вручную</h2>
                </div>
                <div class="card-body">
                    <div class="qr-grid">
                        {% for item in local_uris %}
                        <div class="qr-item">
                            <h3 class="qr-title">{{ item.label }}</h3>
                            {% if item.qrcode %}
                                <img src="{{ item.qrcode }}" class="qrcode">
                            {% endif %}
                            <button class="btn btn-secondary" data-copy-text="{{ item.uri }}">
                                Копировать URI
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/16.0.1/twemoji.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
